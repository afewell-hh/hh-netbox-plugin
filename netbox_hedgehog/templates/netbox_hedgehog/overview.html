{% extends "base/layout.html" %}
{% load static %}

{% block title %}Hedgehog Plugin Dashboard{% endblock %}

{% block header %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'netbox_hedgehog/css/hedgehog.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3><i class="mdi mdi-router-wireless"></i> Hedgehog NetBox Plugin</h3>
                </div>
                <div class="card-body">
                    <h4>üéâ Hedgehog NetBox Plugin Dashboard</h4>
                    <p>Monitor and manage your Hedgehog fabric infrastructure.</p>
                    
                    <!-- Statistics Row -->
                    <div class="row mt-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <h2>{{ fabric_count|default:"ERR" }}</h2>
                                    <p class="mb-0">Total Fabrics</p>
                                    {% if debug_error %}
                                    <small class="text-warning">Debug: {{ debug_error }}</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <h2>{{ vpc_count|default:0 }}</h2>
                                    <p class="mb-0">VPCs</p>
                                    <small class="opacity-75">Network resources</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <h2>{{ gitops_stats.in_sync_count|default:0 }}</h2>
                                    <p class="mb-0">In Sync</p>
                                    <small class="opacity-75">Git ‚Üî Cluster</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <h2>{{ gitops_stats.drift_detected_count|default:0 }}</h2>
                                    <p class="mb-0">Drift Detected</p>
                                    <small class="opacity-75">Needs attention</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                    
                    <!-- Quick Access Row -->
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <div class="card border-primary">
                                <div class="card-body">
                                    <h5 class="card-title">üèóÔ∏è Fabric Management</h5>
                                    <p class="card-text">Manage {{ fabric_count }} Hedgehog fabric installation{{ fabric_count|pluralize }}.</p>
                                    <a href="{% url 'plugins:netbox_hedgehog:fabric_list' %}" class="btn btn-primary btn-block">
                                        <i class="mdi mdi-server-network"></i> Manage Fabrics
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-warning">
                                <div class="card-body">
                                    <h5 class="card-title">üîë Git Repositories</h5>
                                    <p class="card-text">Manage Git repository authentication and connections.</p>
                                    <a href="{% url 'plugins:netbox_hedgehog:gitrepository_list' %}" class="btn btn-warning">
                                        <i class="mdi mdi-git"></i> Manage Repositories
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-success">
                                <div class="card-body">
                                    <h5 class="card-title">‚òÅÔ∏è VPC Management</h5>
                                    <p class="card-text">{{ vpc_count }} Virtual Private Cloud{{ vpc_count|pluralize }} configured.</p>
                                    <a href="{% url 'plugins:netbox_hedgehog:vpc_list' %}" class="btn btn-success">View VPCs</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Network Topology feature removed -->
                    
                    <!-- CRD Management Section -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h4><i class="mdi mdi-kubernetes"></i> CRD Management</h4>
                            <p class="text-muted">Manage Kubernetes Custom Resource Definitions for your Hedgehog fabric infrastructure.</p>
                        </div>
                    </div>
                    
                    <!-- VPC API CRDs -->
                    <div class="row mt-3">
                        <div class="col-12">
                            <h5 class="text-primary"><i class="mdi mdi-cloud-outline"></i> VPC API Resources</h5>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-earth"></i> External Systems</h6>
                                    <p class="card-text text-muted">Configure external BGP systems and connections</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:external_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:external_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-ip-network"></i> IPv4 Namespaces</h6>
                                    <p class="card-text text-muted">Manage IP address allocation namespaces</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:ipv4namespace_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:ipv4namespace_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-attachment"></i> External Attachments</h6>
                                    <p class="card-text text-muted">Connect external systems to fabric ports</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:externalattachment_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:externalattachment_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-transit-connection-variant"></i> External Peerings</h6>
                                    <p class="card-text text-muted">Configure BGP peering relationships</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:externalpeering_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:externalpeering_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-3">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-link-variant"></i> VPC Attachments</h6>
                                    <p class="card-text text-muted">Attach workloads to VPC subnets</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:vpcattachment_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:vpcattachment_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-vector-link"></i> VPC Peerings</h6>
                                    <p class="card-text text-muted">Establish VPC-to-VPC connections</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:vpcpeering_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:vpcpeering_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Wiring API CRDs -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h5 class="text-secondary"><i class="mdi mdi-cable-data"></i> Wiring API Resources</h5>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-connection"></i> Connections</h6>
                                    <p class="card-text text-muted">Physical and logical connections between devices</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:connection_list' %}" class="btn btn-sm btn-outline-secondary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:connection_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-switch"></i> Switches</h6>
                                    <p class="card-text text-muted">Network switch configurations and roles</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:switch_list' %}" class="btn btn-sm btn-outline-secondary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:switch_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-server"></i> Servers</h6>
                                    <p class="card-text text-muted">Server configurations and connections</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:server_list' %}" class="btn btn-sm btn-outline-secondary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:server_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-group"></i> Switch Groups</h6>
                                    <p class="card-text text-muted">Logical groupings of network switches</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:switchgroup_list' %}" class="btn btn-sm btn-outline-secondary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:switchgroup_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-secondary h-100">
                                <div class="card-body">
                                    <h6 class="card-title"><i class="mdi mdi-lan"></i> VLAN Namespaces</h6>
                                    <p class="card-text text-muted">VLAN isolation and namespace management</p>
                                    <div class="btn-group-vertical w-100">
                                        <a href="{% url 'plugins:netbox_hedgehog:vlannamespace_list' %}" class="btn btn-sm btn-outline-secondary">View All</a>
                                        <a href="{% url 'plugins:netbox_hedgehog:vlannamespace_add' %}" class="btn btn-sm btn-success">Create New</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Fabrics -->
                    {% if recent_fabrics %}
                    <div class="row mt-4">
                        <div class="col-12">
                            <h5>Recent Fabrics</h5>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Status</th>
                                            <th>Namespace</th>
                                            <th>Last Sync</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for fabric in recent_fabrics %}
                                        <tr>
                                            <td><a href="{% url 'plugins:netbox_hedgehog:fabric_detail' pk=fabric.pk %}">{{ fabric.name }}</a></td>
                                            <td><span class="badge bg-{{ fabric.status|lower }}">{{ fabric.get_status_display }}</span></td>
                                            <td>{{ fabric.kubernetes_namespace }}</td>
                                            <td>{{ fabric.last_sync|default:"Never" }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}