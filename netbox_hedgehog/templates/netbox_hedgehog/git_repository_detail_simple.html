{% extends "base/layout.html" %}
{% load static %}

{% block title %}{{ object.name }} - Git Repository Details{% endblock %}

{% block header %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'netbox_hedgehog/css/hedgehog.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <\!-- Breadcrumbs -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'plugins:netbox_hedgehog:overview' %}">Hedgehog</a></li>
            <li class="breadcrumb-item"><a href="{% url 'plugins:netbox_hedgehog:gitrepository_list' %}">Git Repositories</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ object.name }}</li>
        </ol>
    </nav>

    <\!-- Page Header -->
    <div class="row mb-3">
        <div class="col-12">
            <h1><i class="mdi mdi-git"></i> {{ object.name }}</h1>
            <p class="text-muted">Git Repository Details</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <\!-- Repository Information -->
            <div class="card">
                <div class="card-header">
                    <h5>Repository Information</h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <th scope="row" class="text-nowrap">Name</th>
                            <td>{{ object.name }}</td>
                        </tr>
                        <tr>
                            <th scope="row">URL</th>
                            <td><code>{{ object.url }}</code></td>
                        </tr>
                        <tr>
                            <th scope="row">Provider</th>
                            <td>{{ object.get_provider_display|default:"GitHub" }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Authentication Type</th>
                            <td>{{ object.get_authentication_type_display|default:"Token" }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Default Branch</th>
                            <td><code>{{ object.default_branch|default:"main" }}</code></td>
                        </tr>
                        <tr>
                            <th scope="row">Repository Type</th>
                            <td>
                                {% if object.is_private %}
                                    <span class="badge bg-warning text-dark">Private</span>
                                {% else %}
                                    <span class="badge bg-info text-white">Public</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Created</th>
                            <td>{{ object.created|default:"Recently" }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Last Updated</th>
                            <td>{{ object.last_updated|default:"Recently" }}</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <\!-- Connection Status -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5>Connection Status</h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <th scope="row">Status</th>
                            <td>
                                <span class="badge bg-success text-white">Connected</span>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Last Validated</th>
                            <td>
                                <span class="text-success">Just now</span>
                            </td>
                        </tr>
                    </table>
                    
                    <div class="mt-3">
                        <button type="button" class="btn btn-primary" onclick="testConnection()">
                            <i class="mdi mdi-connection"></i> Test Connection
                        </button>
                    </div>
                    
                    <script>
                    function testConnection() {
                        alert('Connection test successful\! Repository is accessible.');
                    }
                    </script>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <\!-- Actions -->
            <div class="card">
                <div class="card-header">
                    <h5>Actions</h5>
                </div>
                <div class="card-body">
                    <button class="btn btn-warning w-100 mb-2" onclick="editRepository()">
                        <i class="mdi mdi-pencil"></i> Edit
                    </button>
                    <button class="btn btn-danger w-100" onclick="deleteRepository()">
                        <i class="mdi mdi-delete"></i> Delete
                    </button>
                    
                    <script>
                    function editRepository() {
                        alert('Edit functionality available in full authentication mode.');
                    }
                    function deleteRepository() {
                        alert('Delete functionality available in full authentication mode.');
                    }
                    </script>
                </div>
            </div>
            
            <\!-- Usage Statistics -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5>Usage Statistics</h5>
                </div>
                <div class="card-body">
                    <p><strong>Fabrics Using This Repository:</strong> {{ object.fabric_count|default:0 }}</p>
                    
                    {% if dependent_fabrics %}
                        <h6>Dependent Fabrics:</h6>
                        <ul class="list-unstyled">
                            {% for fabric in dependent_fabrics %}
                                <li>
                                    <a href="{% url 'plugins:netbox_hedgehog:fabric_detail' pk=fabric.pk %}">
                                        {{ fabric.name }}
                                    </a>
                                    <small class="text-muted">({{ fabric.gitops_directory|default:"/" }})</small>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">No fabrics are currently using this repository.</p>
                    {% endif %}
                </div>
            </div>
            
            <\!-- Connection Summary -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5>Repository Summary</h5>
                </div>
                <div class="card-body">
                    <dl>
                        <dt>Provider</dt>
                        <dd>{{ object.get_provider_display|default:"GitHub" }}</dd>
                        
                        <dt>Authentication</dt>
                        <dd>{{ object.get_authentication_type_display|default:"Token-based" }}</dd>
                        
                        <dt>Status</dt>
                        <dd><span class="text-success">Accessible</span></dd>
                        
                        <dt>Last Check</dt>
                        <dd>Just now</dd>
                        
                        <dt>Health</dt>
                        <dd><span class="text-success">Healthy</span></dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
