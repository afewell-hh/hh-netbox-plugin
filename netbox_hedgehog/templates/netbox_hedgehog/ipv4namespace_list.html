{% extends "base/layout.html" %}
{% load static %}
{% load render_table from django_tables2 %}

{% block title %}IPv4 Namespaces{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'netbox_hedgehog/css/hedgehog.css' %}">
{% endblock %}

{% block tabs %}
<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link" href="{% url 'plugins:netbox_hedgehog:overview' %}">
            <i class="mdi mdi-view-dashboard"></i> Overview
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'plugins:netbox_hedgehog:fabric_list' %}">
            <i class="mdi mdi-server-network"></i> Fabrics
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'plugins:netbox_hedgehog:vpc_list' %}">
            <i class="mdi mdi-lan"></i> VPCs
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'plugins:netbox_hedgehog:external_list' %}">
            <i class="mdi mdi-cloud-outline"></i> External Systems
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link active" href="{% url 'plugins:netbox_hedgehog:ipv4namespace_list' %}">
            <i class="mdi mdi-ip-network"></i> IPv4 Namespaces
        </a>
    </li>
    <!-- Topology tab removed -->
</ul>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Fabric Filter Component -->
    {% include "netbox_hedgehog/components/fabric_filter_enhanced.html" %}
    
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="mdi mdi-ip-network"></i> IPv4 Namespaces</h3>
                    <div>
                        {% if perms.netbox_hedgehog.add_ipv4namespace %}
                        <a href="{% url 'plugins:netbox_hedgehog:ipv4namespace_add' %}" class="btn btn-primary">
                            <i class="mdi mdi-plus-thick"></i> Add IPv4 Namespace
                        </a>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                    {% if ipv4namespaces %}
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Fabric</th>
                                        <th>Namespace</th>
                                        <th>Status</th>
                                        <th>Git File</th>
                                        <th>Last Synced</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for ipv4namespace in ipv4namespaces %}
                                    <tr>
                                        <td>
                                            <a href="{% url 'plugins:netbox_hedgehog:ipv4namespace_detail' pk=ipv4namespace.pk %}">
                                                <strong>{{ ipv4namespace.name }}</strong>
                                            </a>
                                        </td>
                                        <td>{{ ipv4namespace.fabric.name }}</td>
                                        <td><code>{{ ipv4namespace.namespace }}</code></td>
                                        <td>
                                            <span class="badge bg-secondary">{{ ipv4namespace.kubernetes_status }}</span>
                                        </td>
                                        <td>
                                            {% if ipv4namespace.git_file_path %}
                                                <small><code>{{ ipv4namespace.git_file_path }}</code></small>
                                            {% else %}
                                                <small class="text-muted">Not from Git</small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if ipv4namespace.last_synced %}
                                                {{ ipv4namespace.last_synced|date:"Y-m-d H:i" }}
                                            {% else %}
                                                <small class="text-muted">Never</small>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        <p><strong>Total:</strong> {{ ipv4namespaces|length }} IPv4 Namespace{{ ipv4namespaces|length|pluralize }}</p>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="mdi mdi-ip-network mdi-48px text-muted mb-3"></i>
                            <h5 class="text-muted">No IPv4 Namespaces Found</h5>
                            <p class="text-muted">
                                IPv4 Namespaces define IP address allocation pools for your Hedgehog fabric.
                            </p>
                            {% if perms.netbox_hedgehog.add_ipv4namespace %}
                            <a href="{% url 'plugins:netbox_hedgehog:ipv4namespace_add' %}" class="btn btn-primary mt-3">
                                <i class="mdi mdi-plus-thick"></i> Add Your First IPv4 Namespace
                            </a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    {% if ipv4namespaces %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="mdi mdi-information-outline"></i> About IPv4 Namespaces</h5>
                </div>
                <div class="card-body">
                    <p>
                        IPv4 Namespaces in Hedgehog define IP address allocation pools that can be used across your fabric.
                        They help manage IP address allocation and ensure no conflicts occur between different parts of your network.
                    </p>
                    <ul>
                        <li><strong>Subnets:</strong> Define the IP ranges available for allocation</li>
                        <li><strong>Fabric Association:</strong> Link namespaces to specific fabrics</li>
                        <li><strong>Kubernetes Integration:</strong> Sync with Kubernetes CRDs</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block javascript %}
<script src="{% static 'netbox_hedgehog/js/hedgehog.js' %}"></script>
{% endblock %}